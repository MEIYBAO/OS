# OS
操作系统课设

## 项目简介
使用 Python + Tkinter 编写的操作系统动态可视化模拟器，包含进程管理、处理器调度、存储管理、虚拟内存和文件管理的核心概念。预置了多个进程脚本，可观察每一步的状态变化、缺页/置换、文件操作和 I/O 阻塞。

### 场景亮点

- **进程管理：生产者-消费者同步**：模拟互斥锁、缓冲区空/满等待，展示同步和互斥带来的阻塞与唤醒。
- **处理器调度：三级多级反馈队列**：Q0/Q1/Q2 时间片分别为 1/2/4，实时显示各级队列变化及降级/唤醒策略，背景持续插入新作业保证调度活跃。
- **存储管理：基本分页与请求分页虚存**：彩色网格展示帧占用与空闲帧列表，点击任意进程即可查看完整页表，缺页/置换过程动态高亮。
- **资源与文件竞争**：除互斥缓冲区外还加入磁带机/GPU/打印机等共享资源与文件操作，演示多类资源争用。
- **持久事件日志**：日志滚动追加，不覆盖旧记录，便于回溯整个运行过程。
- **缓冲池可视化**：生产者-消费者缓冲池以条形槽位展示，标注 in/out 指针，点击进程可同步查看其页表与帧占用。

## 运行方式

1. 确认已安装 Python 3（自带 Tkinter）。
2. 在仓库根目录执行：

   ```bash
   python main.py
   ```

3. 界面说明：
   - **单步执行**：手动推进一个时间片，查看调度、缺页、文件操作等日志。
   - **自动运行**：连续推进，每 0.8 秒展示一次快照，可随时暂停。
   - **重置**：恢复到初始场景，重新开始观察。

无需额外依赖，适合课堂演示或个人实验。

## 模拟流程与逻辑结构

### 全局循环（一个时间片）

1. **时钟推进**：`clock` 自增并记录一条时间刻日志，便于分段回放。
2. **进程到达**：检查所有 `arrival_time ≤ clock` 的新作业，将其放入最高优先级队列 Q0（同时后台每 4 个时间片自动插入一条动态作业，保持调度压力）。
3. **阻塞检查**：
   - I/O 阻塞：`io_timer` 递减到 0 时唤醒，重新进入 Q0。
   - 同步/资源阻塞：互斥锁、缓冲区满/空、共享资源（磁带机/GPU/打印机）满足条件时唤醒，仍放入 Q0。
4. **调度**：按 Q0→Q1→Q2 顺序选择首个就绪进程运行，标记为 `Running`，并记录所用时间片长度（1/2/4）。
5. **执行一条动作**：支持 CPU、I/O、访存（请求分页）、生产/消费、资源申请/释放、文件 CRUD。执行完成后：
   - 若动作耗尽，进程转入完成队列。
   - 若用完当前时间片，进程降级到下一队列并清空时间片计数。
   - 其他情况继续保持队列级别，等待下一轮调度。

### 生产者-消费者与缓冲池

- **数据结构**：环形缓冲区容量 5，维护 `slots`（记录占用 PID）、`in`/`out` 指针和当前 `used` 数。
- **互斥与同步**：
  - 生产时需持有互斥锁，满则阻塞在“等待空槽”；成功则写入 `slots[in]`，移动 `in`。
  - 消费时同理，空则阻塞在“等待产品”；成功时清空 `slots[out]`，移动 `out`。
- **可视化**：右侧“生产者-消费者缓冲池”以水平槽位表示缓冲区，槽位填充颜色对应生产它的进程；红/蓝箭头分别标记 `in`/`out`，标题显示 `已用/容量`。缓冲区永远不会出现“只有消费者无产品”或“只有生产者无空位”的假动作：当条件不满足时进程会阻塞并等待唤醒。

### 存储管理与虚存

- **基本分页**：物理帧固定 20 格，彩色网格显示帧号、所属进程及页号，右侧列表展示空闲帧。点击任意进程行，可在页表树中查看其全部页（未装入也显示）。
- **请求分页**：访存动作调用 `MemoryManager.access_page`，缺页时从空闲帧或替换策略分配帧，并更新页表/帧表；命中/置换信息都会写入日志并高亮最近访问的帧。

### 进程脚本与资源竞争

- **生产者/消费者样例**：预置两个生产者（A、C）和两个消费者（B、D），生产动作数多于消费动作，缓冲区可反复经历“满→阻塞→唤醒”和“空→阻塞→唤醒”。
- **系统作业**：备份程序演示文件创建/写入/删除与磁带机占用，数据库作业展示 GPU 竞争、磁盘 I/O 与多页访存。动态插入的短作业用于演示调度抢占与访存命中。

### 文件系统

- 使用内存文件表记录拥有者与大小，支持创建、读、写、删除，并在事件日志中记录结果（成功、权限限制或不存在）。

### 日志与交互

- **事件日志**：所有动作、调度、阻塞/唤醒、缺页/置换、文件与资源事件按时间顺序追加，可滚动回顾，不会覆盖旧行。
- **进程/页表联动**：点击进程列表行即可切换页表视图，与内存帧颜色对应，便于关联页号与帧号。
